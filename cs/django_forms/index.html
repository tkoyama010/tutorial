
<!DOCTYPE HTML>
<html lang="cs" >
    <head>
        <meta charset="UTF-8">
        <title>Django formuláře · HonKit</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="HonKit 3.7.5">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-richquotes/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-language-picker/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-sidebar-ad/sidebar-ad.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-codeblock-label/block.css">
                
            
                
                <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-sectionx-ex/sectionx.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/@honkit/honkit-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../whats_next/" />
    
    
    <link rel="prev" href="../extend_your_application/" />
    

    </head>
    <body>
        
<div class="book honkit-cloak">
    <div class="book-summary">
        
  
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Vyhledat" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    
    
        
        <li>
            <a href="https://gitter.im/DjangoGirls/tutorial" target="_blank" class="custom-link">Need help? Talk to us!</a>
        </li>
    
    

    
    <li class="divider"></li>
    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Úvod
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../installation/">
            
                <a href="../installation/">
            
                    
                    Instalace
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../how_the_internet_works/">
            
                <a href="../how_the_internet_works/">
            
                    
                    Jak funguje internet
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../intro_to_command_line/">
            
                <a href="../intro_to_command_line/">
            
                    
                    Úvod do příkazové řádky
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../python_installation/">
            
                <a href="../python_installation/">
            
                    
                    Instalace Pythonu
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../code_editor/">
            
                <a href="../code_editor/">
            
                    
                    Editor zdrojového kódu
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../python_introduction/">
            
                <a href="../python_introduction/">
            
                    
                    Úvod do Pythonu
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../django/">
            
                <a href="../django/">
            
                    
                    Co je Django?
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../django_installation/">
            
                <a href="../django_installation/">
            
                    
                    Instalace Django
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="../django_start_project/">
            
                <a href="../django_start_project/">
            
                    
                    Tvůj první Django projekt!
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="../django_models/">
            
                <a href="../django_models/">
            
                    
                    Django modely
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="../django_admin/">
            
                <a href="../django_admin/">
            
                    
                    Django admin
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="../deploy/">
            
                <a href="../deploy/">
            
                    
                    Nasazení!
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14" data-path="../django_urls/">
            
                <a href="../django_urls/">
            
                    
                    Django URL
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15" data-path="../django_views/">
            
                <a href="../django_views/">
            
                    
                    Django views -- je čas začít tvořit!
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16" data-path="../html/">
            
                <a href="../html/">
            
                    
                    Úvod do HTML
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17" data-path="../django_orm/">
            
                <a href="../django_orm/">
            
                    
                    Django ORM (tvorba dotazů)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18" data-path="../dynamic_data_in_templates/">
            
                <a href="../dynamic_data_in_templates/">
            
                    
                    Dynamická data v šablonách
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19" data-path="../django_templates/">
            
                <a href="../django_templates/">
            
                    
                    Django šablony
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.20" data-path="../css/">
            
                <a href="../css/">
            
                    
                    CSS - udělejte svou aplikaci hezčí
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.21" data-path="../template_extending/">
            
                <a href="../template_extending/">
            
                    
                    Rozšíření šablon
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.22" data-path="../extend_your_application/">
            
                <a href="../extend_your_application/">
            
                    
                    Rozšíření vaší aplikace
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.23" data-path="./">
            
                <a href="./">
            
                    
                    Django formuláře
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.24" data-path="../whats_next/">
            
                <a href="../whats_next/">
            
                    
                    Co dál?
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://github.com/honkit/honkit" target="blank" class="gitbook-link">
            Publikováno pomocí HonKit
        </a>
    </li>
</ul>


                </nav>
            
        
  <div class="sidebar-addition">
      
        <a href="https://www.patreon.com/djangogirls" target="_blank">
      
        <img src="https://djangogirls.org/static/img/global/donate/lagos.jpg" />
      
        </a>
      
      
        <p>💖 Support our work and donate to our project! ✨</p>
      
      
      <a href="https://www.patreon.com/djangogirls" class="btn" target="_blank">
        Donate now!
      </a>
      
  </div>

    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Django formuláře</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="django-formuláře">Django formuláře</h1>
<p>Poslední věc, kterou chceme udělat na našich webových stránkách, je vytvořit pohodlný způsob, jak přidávat a upravovat příspěvky na blogu. Django <code>admin</code> je super, ale je těžké ho přizpůsobit a upravit do hezčí podoby. S <code>formuláři</code> budeme mít absolutní moc nad naším rozhraním - můžeme dělat téměř cokoliv, co si dokážeme představit!</p>
<p>Pěkná věc na Django formulářích je, že je můžeme definovat úplně od počátku nebo vytvořit <code>ModelForm</code>, který uloží výsledek z formuláře pomocí modelu.</p>
<p>To je přesně to, co chceme udělat: vytvoříme formulář pro náš model <code>Post</code>.</p>
<p>Stejně jako všechny důležité části Djanga mají formuláře své vlastní soubory: <code>forms.py</code>.</p>
<p>V našem adresáři potřebujeme vytvořit soubor s názvem <code>blog</code>.</p>
<pre><code>blog
 └── forms.py
</code></pre><p>OK, otevři ho a zadej následující kód:</p>
<pre><code class="lang-python"> <span class="hljs-keyword">from</span> django <span class="hljs-keyword">import</span> forms

 <span class="hljs-keyword">from</span> .models <span class="hljs-keyword">import</span> Post

 <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PostForm</span>(<span class="hljs-params">forms.ModelForm</span>):</span>
     <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Meta</span>:</span>
         model = Post
         fields = (<span class="hljs-string">&apos;title&apos;</span>, <span class="hljs-string">&apos;text&apos;</span>,)
</code></pre>
<p>Musíme nejdříve importovat Django formuláře (<code>from django import forms</code>) a samozřejmě náš <code>Post</code> model (<code>from .models import Post</code>).</p>
<p><code>PostForm</code>, jak asi předpokládáš, je jméno našeho formuláře. Musíme říct Djangu, že tento formulář je <code>ModelForm</code> (tak pro nás bude moci Django udělat něco magického) - zodpovědný za to bude <code>forms.ModelForm</code>.</p>
<p>Dále zde máme <code>třídu Meta</code>, kde řekneme Djangu, který model by měl být použit k vytvoření tohoto formuláře (<code>model = Post</code>).</p>
<p>Nakonec můžeme Djangu říct, co se má stát s jednotlivými poli našeho formuláře. V tomto případě chceme pouze zobrazit pole <code>nadpis/title</code> a <code>text</code> - <code>autor</code> by měl být člověk, který je aktuálně přihlášen (ty!) a <code>created_date</code> by mělo být automaticky nastaveno, když vytvoříme příspěvek (tj. v kódu).</p>
<p>A je to! Vše, co teď musíme udělat, je použít formulář ve <em>view</em> a zobrazit ho v šabloně.</p>
<p>Takže ještě jednou: budeme vytvářet odkaz na stránky, URL, pohled a šablonu.</p>
<h2 id="odkaz-na-stránku-s-formulářem">Odkaz na stránku s formulářem</h2>
<p>Je tedy čas otevřít soubor <code>blog/templates/blog/base.html</code>. Přidáme odkaz do <code>div</code> s názvem <code>page-header</code>:</p>
<pre><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;{% url &apos;post_new&apos; %}&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;top-menu&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;glyphicon glyphicon-plus&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
</code></pre>
<p>Všimni si, že chceme zavolat náš nový view <code>post_new</code>.</p>
<p>Po přidání řádku by měl tvůj html soubor vypadat takto:</p>
<pre><code class="lang-html">{% load staticfiles %}
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Django Girls blog<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css&quot;</span>&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css&quot;</span>&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&apos;//fonts.googleapis.com/css?family=Lobster&amp;subset=latin,latin-ext&apos;</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&apos;stylesheet&apos;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&apos;text/css&apos;</span>&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;{% static &apos;css/blog.css&apos; %}&quot;</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;page-header&quot;</span>&gt;</span>
             <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;{% url &apos;post_new&apos; %}&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;top-menu&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;glyphicon glyphicon-plus&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
             <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/&quot;</span>&gt;</span>Django Girls Blog<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
         <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;content container&quot;</span>&gt;</span>
             <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;row&quot;</span>&gt;</span>
                 <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;col-md-8&quot;</span>&gt;</span>
                     {% block content %}
                     {% endblock %}
                 <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
             <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
         <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>Po uložení a obnovení stránky <a href="http://127.0.0.1:8000" target="_blank">http://127.0.0.1:8000</a> patrně uvidíš známou <code>NoReverseMatch</code> chybu.</p>
<h2 id="url">URL</h2>
<p>Otevři <code>blog/urls.py</code> a přidej řádek:</p>
<pre><code class="lang-python">url(<span class="hljs-string">r&apos;^post/new/$&apos;</span>, views.post_new, name=<span class="hljs-string">&apos;post_new&apos;</span>),
</code></pre>
<p>Výsledný kód bude vypadat takto:</p>
<pre><code class="lang-python"> <span class="hljs-keyword">from</span> django.conf.urls <span class="hljs-keyword">import</span> url
 <span class="hljs-keyword">from</span> . <span class="hljs-keyword">import</span> views

urlpatterns = [
     url(<span class="hljs-string">r&apos;^$&apos;</span>, views.post_list, name=<span class="hljs-string">&apos;post_list&apos;</span>),
     url(<span class="hljs-string">r&apos;^post/(?P&lt;pk&gt;[0-9]+)/$&apos;</span>, views.post_detail, name=<span class="hljs-string">&apos;post_detail&apos;</span>),
     url(<span class="hljs-string">r&apos;^post/new/$&apos;</span>, views.post_new, name=<span class="hljs-string">&apos;post_new&apos;</span>),
]
</code></pre>
<p>Po aktualizaci webu vidíme <code>AttributeError</code>, protože nemáme implementovaný <code>post_new</code> view. Přidáme ho právě teď.</p>
<h2 id="postnew-view">post_new view</h2>
<p>Musíme otevřít soubor <code>blog/views.py</code> a přidat následující řádky:</p>
<pre><code class="lang-python"><span class="hljs-keyword">from</span> .forms <span class="hljs-keyword">import</span> PostForm
</code></pre>
<p>a náš <em>view</em>:</p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">post_new</span>(<span class="hljs-params">request</span>):</span>
     form = PostForm()
     <span class="hljs-keyword">return</span> render(request, <span class="hljs-string">&apos;blog/post_edit.html&apos;</span>, {<span class="hljs-string">&apos;form&apos;</span>: form})
</code></pre>
<p>Chceš-li vytvořit nový formulář <code>Post</code>, musíš zavolat <code>PostForm()</code> a předat ho do šablony. Za chvilku se vrátíme k tomuto <em>view</em>, ale teď pojďme rychle vytvořit šablonu formuláře.</p>
<h2 id="šablona">Šablona</h2>
<p>Musíme vytvořit soubor <code>post_edit.html</code> v adresáři <code>blog/templates/blog</code>. Pro vytvoření formuláře potřebujeme udělat několik věcí:</p>
<ul>
<li>musíme zobrazit formulář. Můžeme to udělat například jednoduchým <code>{{ form.as_p }}</code>.</li>
<li>formulář musíme obalit HTML značkou (přidej řádek nad formulář): <code>&lt; method=&quot;POST&quot; &gt;... &lt; / form &gt;</code></li>
<li>potřebujeme tlačítko <code>Uložit</code>. Vytvoříme HTML tlačítko: <code>&lt; button type=&quot;submit&quot;&gt; Uložit &lt; / button&gt;</code></li>
<li>a nakonec těsně za otevírací značku <code>&lt; form... &gt;</code> musíme přidat <code>{% csrf_token %}</code>. Toto je velmi důležité, protože tak vytvoříme bezpečnější formulář! Django si bude stěžovat v okamžiku, kdy se pokusíš uložit formulář, pokud zapomeneš na tuto část:</li>
</ul>
<p><img src="images/csrf2.png" alt="CSFR zakázaná stránka"></p>
<p>Pojďme se nyní podívat, jak by mělo vypadat HTML v <code>post_edit.html</code>:</p>
<pre><code class="lang-html">{% extends &apos;blog/base.html&apos; %}

{% block content %}
     <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>New post<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;POST&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;post-form&quot;</span>&gt;</span>{% csrf_token %}
         {{ form.as_p }}
         <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;save btn btn-default&quot;</span>&gt;</span>Save<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
     <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
{% endblock %}
</code></pre>
<p>Čas aktualizovat naší stránku! Hurá! Zobrazil se formulář!</p>
<p><img src="images/new_form2.png" alt="Nový formulář"></p>
<p>Ale ještě chvilku počkej! Když něco zadáš do polí <code>titulek</code> a <code>text</code> a pokusíš se formulář uložit - co se stane?</p>
<p>Nic! Jsme opět na stejné stránce, náš text je pryč... a nepřidal se žádný nový příspěvek. Tak co se stalo?</p>
<p>Odpověď je: nic. Musíme ještě trochu zapracovat na našem <em>view</em>.</p>
<h2 id="ukládání-formuláře">Ukládání formuláře</h2>
<p>Otevři znovu <code>blog/views.py</code>. Vše, co máme aktuálně v <code>post_new</code>, je toto:</p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">post_new</span>(<span class="hljs-params">request</span>):</span>
     form = PostForm()
     <span class="hljs-keyword">return</span> render(request, <span class="hljs-string">&apos;blog/post_edit.html&apos;</span>, {<span class="hljs-string">&apos;form&apos;</span>: form})
</code></pre>
<p>Když odešleme formulář, vrátíme se zpět na ten samý view, ale tentokrát obdržíme nějaká další data v <code>request</code>, přesněji v <code>request.POST</code> (pojmenování nemá nic společného s naším &quot;post&quot; v blogu, vychází to z toho, že &quot;zasíláme&quot; data). Pamatuješ si, že v našem HTML souboru ve <code>&lt;form&gt;</code> jsme definovali proměnnou <code>method=&quot;POST&quot;</code>? Všechna pole z formuláře jsou nyní k dispozici v proměnné <code>request.POST</code>. Neměla bys přejmenovávat <code>POST</code> na něco jiného (jediná další platná hodnota proměnné <code>method</code> je <code>GET</code>, ale teď tady nebudeme vysvětlovat rozdíly).</p>
<p>Takže v našem <em>view</em> máme dvě samostatné situace ke zpracování. První: když načteme stránku poprvé a chceme dostat prázdný formulář. Druhou: když se vrátíme zpět do našeho <em>view</em> s vyplněnými daty formuláře. Takže musíme přidat podmínku (použijeme na to <code>if</code>).</p>
<pre><code class="lang-python"><span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&quot;POST&quot;</span>:
     [...]
<span class="hljs-keyword">else</span>:
     form = PostForm()
</code></pre>
<p>Teď je čas k vyplnění mezer <code>[...]</code>. Je-li <code>method</code> <code>POST</code>, chceme vytvořit <code>PostForm</code> s údaji z formuláře, že? Udělejme to:</p>
<pre><code class="lang-python">form = PostForm(request.POST)
</code></pre>
<p>Snadné! Další věcí je zjistit, zda-li je formulář v pořádku (všechna požadovaná pole jsou vyplněna a neobsahují špatné hodnoty). Uděláme to pomocí <code>form.is_valid()</code>.</p>
<p>Zkontrolujeme, je-li formulář platný, a pokud ano, můžeme ho uložit!</p>
<pre><code class="lang-python"><span class="hljs-keyword">if</span> form.is_valid():
     post = form.save(commit=<span class="hljs-literal">False</span>)
     post.author = request.user
     post.published_date = timezone.now()
     post.save()
</code></pre>
<p>V podstatě, tady máme dvě věci: ukládáme formulář pomocí <code>form.save</code> a přidáváme autora (vzhledem k tomu, že v <code>PostForm</code> nebylo žádné pole <code>Autor</code> a toto pole je požadováno!). <code>commit=False</code> znamená, že ještě nechceme <code>Post</code> uložit pomocí modelu - chceme nejdříve přidat autora. Většinu času budeš používat <code>form.save()</code>, bez <code>commit=False</code>, ale v tomto případě to potřebujeme takto udělat. <code>post.save()</code> zachová změny (přidá autora) a vytvoří nový příspěvek na blogu!</p>
<p>A nakonec by bylo úžasné, pokud bychom okamžitě přešli na stránku <code>post_detail</code> s nově vytvořeným příspěvkem, že ano? K tomu potřebujeme jeden další import:</p>
<pre><code class="lang-python"><span class="hljs-keyword">from</span> django.shortcuts <span class="hljs-keyword">import</span> redirect
</code></pre>
<p>Přidej to na samý začátek souboru. A nyní můžeš říci: Jdi na stránku <code>post_detail</code> s nově vytvořeným příspěvkem.</p>
<pre><code class="lang-python"><span class="hljs-keyword">return</span> redirect(<span class="hljs-string">&apos;post_detail&apos;</span>, pk=post.pk)
</code></pre>
<p><code>post_detail</code> je název pohledu, na který chceme jít. Pamatuj si, že tento <em>view</em> vyžaduje proměnnou <code>pk</code>. Pro předání do view použijeme <code>pk=post.pk</code>, kde <code>post</code> je nově vytvořený příspěvek!</p>
<p>Už jsme si toho řekly hodně, ale pravděpodobně chceš vidět, jak nyní celý <em>view</em> vypadá nyní, nemám pravdu?</p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">post_new</span>(<span class="hljs-params">request</span>):</span>
    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&quot;POST&quot;</span>:
        form = PostForm(request.POST)
        <span class="hljs-keyword">if</span> form.is_valid():
            post = form.save(commit=<span class="hljs-literal">False</span>)
            post.author = request.user
            post.published_date = timezone.now()
            post.save()
            <span class="hljs-keyword">return</span> redirect(<span class="hljs-string">&apos;post_detail&apos;</span>, pk=post.pk)
    <span class="hljs-keyword">else</span>:
        form = PostForm()
    <span class="hljs-keyword">return</span> render(request, <span class="hljs-string">&apos;blog/post_edit.html&apos;</span>, {<span class="hljs-string">&apos;form&apos;</span>: form})
</code></pre>
<p>Pojďme se podívat, jestli to funguje. Přejdi na stránku <a href="http://127.0.0.1:8000/post/new/" target="_blank">http://127.0.0.1:8000/post/new/</a>, přidej <code>title</code> a <code>text</code>, ulož jej... a hle! Byl přidán nový příspěvek na blog a my jsme přesměrovány na stránku <code>post_detail</code>!</p>
<p>Možná jsi si všimla, že jsme nastavili proměnnou publish_date před uložením postu. Později si ukážeme <em>tlačítko Publikovat</em> v <strong>Django girls tutorial: rozšíření</strong>.</p>
<h2 id="ověření-formuláře">Ověření formuláře</h2>
<p>A teď ti ukážeme, jak cool jsou formuláře v Djangu. Blog příspěvek musí mít <code>title</code> a <code>text</code> pole. V našem modelu <code>Post</code> jsme neřekly (na rozdíl od <code>published_date</code>), že jsou tato pole nepovinná, takže Django ve výchozím nastavení očekává, že budou vyplněná.</p>
<p>Pokus se uložit formulář bez <code>nadpisu</code> a <code>textu</code>. Hádej, co se stane!</p>
<p><img src="images/form_validation2.png" alt="Ověření formuláře"></p>
<p>Django se stará o ověřování, že všechna pole v našem formuláři jsou správně. Není to skvělé?</p>
<blockquote>
<p>Jelikož jsme nedávno použily Django admin rozhraní, systém si v současné době myslí, že jsme přihlášeni. Existuje několik situací, které by mohly vést k našemu odhlášení (zavření prohlížeče, restartováním DB, atd.). Pokud při vytváření příspěvku dostaneš chybu, upozorňující na nepřihlášeného uživatele, zamiř na <a href="http://127.0.0.1:8000/admin" target="_blank">http://127.0.0.1:8000/admin</a> a přihlas se znovu. Tím se dočasně vyřeší tento problém. Existuje trvalá oprava, která na tebe čeká v <strong>domácím úkolu: zabezpeč svůj web!</strong> v kapitole za hlavním tutorialem.</p>
</blockquote>
<p><img src="images/post_create_error.png" alt="Chyba přihlášení"></p>
<h2 id="upravit-formulář">Upravit formulář</h2>
<p>Teď víme, jak přidat nový formulář. Ale co když chceme upravit stávající? Je to velmi podobné tomu, co jsme před chvílí dělaly. Vytvoříme teď rychle některé důležité věci (pokud něčemu neporozumíš, měla bys požádat svého kouče nebo se podívat do předchozích kapitol, protože jsme již všechny tyto kroky probíraly).</p>
<p>Otevři <code>blog/templates/blog/post_detail.html</code> a přidej následující řádek:</p>
<pre><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-default&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;{% url &apos;post_edit&apos; pk=post.pk %}&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;glyphicon glyphicon-pencil&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
</code></pre>
<p>tak, aby šablona vypadala takto:</p>
<pre><code class="lang-html">{% extends &apos;blog/base.html&apos; %}
{% block content %}
     <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;post&quot;</span>&gt;</span>
         {% if post.published_date %}
             <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;date&quot;</span>&gt;</span>
                 {{ post.published_date }}
             <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
         {% endif %}
         <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-default&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;{% url &apos;post_edit&apos; pk=post.pk %}&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;glyphicon glyphicon-pencil&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>{{ post.title }}<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{{ post.text|linebreaksbr }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
     <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
{% endblock %}
</code></pre>
<p>V <code>blog/urls.py</code> přidej tento řádek:</p>
<pre><code class="lang-python">     url(<span class="hljs-string">r&apos;^post/(?P&lt;pk&gt;[0-9]+)/edit/$&apos;</span>, views.post_edit, name=<span class="hljs-string">&apos;post_edit&apos;</span>),
</code></pre>
<p>Znovu použijeme šablonu <code>blog/templates/blog/post_edit.html</code>, takže jediné, co chybí, je <em>view</em>.</p>
<p>Otevři <code>blog/views.py</code> a přidej na samý konec souboru:</p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">post_edit</span>(<span class="hljs-params">request, pk</span>):</span>
     post = get_object_or_404(Post, pk=pk)
     <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&quot;POST&quot;</span>:
         form = PostForm(request.POST, instance=post)
         <span class="hljs-keyword">if</span> form.is_valid():
             post = form.save(commit=<span class="hljs-literal">False</span>)
             post.author = request.user
             post.published_date = timezone.now()
             post.save()
             <span class="hljs-keyword">return</span> redirect(<span class="hljs-string">&apos;blog.views.post_d etail&apos;</span>, pk=post.pk)
     <span class="hljs-keyword">else</span>:
         form = PostForm(instance=post)
     <span class="hljs-keyword">return</span> render(request, <span class="hljs-string">&apos;blog/post_edit.html&apos;</span>, {<span class="hljs-string">&apos;form&apos;</span>: form})
</code></pre>
<p>Vypadá to téměř úplně stejně jako náš view <code>post_new</code>. Ale ne zcela. Za prvé: máme navíc parametr <code>pk</code> z adresy URL. Za druhé: získáme model <code>Post</code>, který chceme upravit, pomocí <code>get_object_or_404 (Post, pk = pk)</code>. Když potom vytvoříme formulář, předáme tento post jako parametr <code>instance</code>, když ukládáme formulář:</p>
<pre><code class="lang-python">form = PostForm(request.POST, instance=post)
</code></pre>
<p>a když jsme otevřely formulář s tímto příspěvkem pro úpravu:</p>
<pre><code class="lang-python">form = PostForm(instance=post)
</code></pre>
<p>Ok, vyzkoušejme si, jestli to funguje! Pojďme na stránku <code>post_detail</code>. Tam by mělo být tlačítko Edit v pravém horním rohu:</p>
<p><img src="images/edit_button2.png" alt="Tlačítko Upravit"></p>
<p>Po klepnutí na něj se zobrazí formulář s naším příspěvkem:</p>
<p><img src="images/edit_form2.png" alt="Upravit formulář"></p>
<p>Neboj se změnit název nebo text a ulož změny!</p>
<p>Blahopřejeme! Tvoje aplikace je skoro kompletní!</p>
<p>Pokud potřebuješ více informací o Django formulářích, měla by sis přečíst dokumentaci: <a href="https://docs.djangoproject.com/en/1.8/topics/forms/" target="_blank">https://docs.djangoproject.com/en/1.8/topics/forms/</a></p>
<h2 id="zabezpečení">Zabezpečení</h2>
<p>Být schopná vytvářet nové příspěvky pouhým klepnutím na odkaz je super! Právě teď ale každý, kdo přijde na tvé stránky, je schopen odeslat nový příspěvek na blog a to asi nechceš. Udělejme to tak, že se tlačítko zobrazí tobě, ale nezobrazí se nikomu jinému.</p>
<p>V <code>blog/templates/blog/base.html</code> najdeš naši <code>page-header</code>, <code>div</code> a tag <code>a</code>, který jsme tam dali dříve. Řádek by měl vypadat nějak takto:</p>
<pre><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;{% url &apos;post_new&apos; %}&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;top-menu&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;glyphicon glyphicon-plus&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
</code></pre>
<p>Chceme přidat další <code>{% if %}</code> příkaz, který zajistí, že se odkaz zobrazí pouze pro uživatele, kteří jsou přihlášeni jako admin. Ve skutečnosti jsi jím pouze ty! Změň tag <code>&lt; a &gt;</code>, aby vypadal takto:</p>
<pre><code class="lang-html">{% if user.is_authenticated %}
     <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;{% url &apos;post_new&apos; %}&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;top-menu&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;glyphicon glyphicon-plus&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
{% endif %}
</code></pre>
<p>Tento <code>{% if %}</code> způsobí, že odkaz bude odeslán do prohlížeče, pouze pokud je uživatel, který požaduje stránku, přihlášený. To zcela nezabrání možnosti vytvářet nové záznamy, ale je to dobrý první krok. Lepší zabezpečení vysvětlíme v rozšířené lekci.</p>
<p>Vzhledem k tomu, že jsi pravděpodobně přihlášená, neuvidíš žádnou změnu, pokud aktualizuješ stránku. Při načtení stránky v novém prohlížeči nebo anonymním okně se odkaz již neukáže!</p>
<h2 id="ještě-jedna-věc-čas-nasadit-aplikaci">Ještě jedna věc: čas nasadit aplikaci!</h2>
<p>Uvidíme, jestli to funguje na PythonAnywhere. Čas na další nasazení!</p>
<ul>
<li>Za prvé commitni nový kód a pošli ho na GitHub</li>
</ul>
<pre><code>$ git status
$ git add --all .
$ git status
$ git commit -m &quot;Added views to create/edit blog post inside the site.&quot;
$ git push
</code></pre><ul>
<li>Pak v <a href="https://www.pythonanywhere.com/consoles/" target="_blank">Bash konzoli PythonAnywhere</a>:</li>
</ul>
<pre><code>$ cd my-first-blog
$ source myvenv/bin/activate
(myvenv)$ git pull
[...]
(myvenv)$ python manage.py collectstatic
[...]
</code></pre><ul>
<li>Nakonec skoč na <a href="https://www.pythonanywhere.com/web_app_setup/" target="_blank">kartu Web</a> a klikni na <strong>Reload</strong>.</li>
</ul>
<p>A mělo by to být! Gratulujeme :)</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="../extend_your_application/" class="navigation navigation-prev " aria-label="Previous page: Rozšíření vaší aplikace">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../whats_next/" class="navigation navigation-next " aria-label="Next page: Co dál?">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Django formuláře","level":"1.23","depth":1,"next":{"title":"Co dál?","level":"1.24","depth":1,"path":"whats_next/README.md","ref":"whats_next/README.md","articles":[]},"previous":{"title":"Rozšíření vaší aplikace","level":"1.22","depth":1,"path":"extend_your_application/README.md","ref":"extend_your_application/README.md","articles":[]},"dir":"ltr"},"config":{"plugins":["heading-anchors@1.0.3","ga@1.0.1","richquotes@0.0.9","github@2.0.0","language-picker","sidebar-ad","codeblock-label","sectionx-ex","collapsible-menu"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"collapsible-menu":{},"language-picker":{"grid-columns":3},"github":{"url":"https://github.com/DjangoGirls/tutorial"},"codeblock-label":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sectionx-ex":{},"fontsettings":{"theme":"white","family":"sans","size":2},"richquotes":{"default":false},"sectionx":{"tag":"b"},"heading-anchors":{},"sidebar-ad":{"imageUrl":"https://djangogirls.org/static/img/global/donate/lagos.jpg","url":"https://www.patreon.com/djangogirls","description":"💖 Support our work and donate to our project! ✨","btnText":"Donate now!"},"highlight":{},"ga":{"configuration":"auto","token":"UA-51680040-3"},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56},"embedFonts":false},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{"py_version":"3.8","py_release":"3.8.6","py_min_version":"3.6","py_min_release":"3.6.8","pa_py_version":"3.8","django_version":"3.2.10"},"language":"cs","links":{"sidebar":{"Need help? Talk to us!":"https://gitter.im/DjangoGirls/tutorial"}},"gitbook":"*"},"file":{"path":"django_forms/README.md","mtime":"2022-11-25T15:12:59.831Z","type":"markdown"},"gitbook":{"version":"3.7.5","time":"2022-11-25T15:13:18.368Z"},"basePath":"..","book":{"language":"cs"}});
        });
    </script>
</div>

        
    <noscript>
        <style>
            .honkit-cloak {
                display: block !important;
            }
        </style>
    </noscript>
    <script>
        // Restore sidebar state as critical path for prevent layout shift
        function __init__getSidebarState(defaultValue){
            var baseKey = "";
            var key = baseKey + ":sidebar";
            try {
                var value = localStorage[key];
                if (value === undefined) {
                    return defaultValue;
                }
                var parsed = JSON.parse(value);
                return parsed == null ? defaultValue : parsed;
            } catch (e) {
                return defaultValue;
            }
        }
        function __init__restoreLastSidebarState() {
            var isMobile = window.matchMedia("(max-width: 600px)").matches;
            if (isMobile) {
                // Init last state if not mobile
                return;
            }
            var sidebarState = __init__getSidebarState(true);
            var book = document.querySelector(".book");
            // Show sidebar if it enabled
            if (sidebarState && book) {
                book.classList.add("without-animation", "with-summary");
            }
        }

        try {
            __init__restoreLastSidebarState();
        } finally {
            var book = document.querySelector(".book");
            book.classList.remove("honkit-cloak");
        }
    </script>
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/1.2.1/anchor.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-heading-anchors/anchor-style.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-ga/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-language-picker/plugin.js"></script>
        
    
        
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sectionx-ex/sectionx.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-collapsible-menu/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

