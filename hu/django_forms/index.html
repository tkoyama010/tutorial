
<!DOCTYPE HTML>
<html lang="hu" >
    <head>
        <meta charset="UTF-8">
        <title>Django űrlapok · HonKit</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="HonKit 3.7.5">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-richquotes/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-language-picker/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-sidebar-ad/sidebar-ad.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-codeblock-label/block.css">
                
            
                
                <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-sectionx-ex/sectionx.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/@honkit/honkit-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../whats_next/" />
    
    
    <link rel="prev" href="../extend_your_application/" />
    

    </head>
    <body>
        
<div class="book honkit-cloak">
    <div class="book-summary">
        
  
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    
    
        
        <li>
            <a href="https://gitter.im/DjangoGirls/tutorial" target="_blank" class="custom-link">Need help? Talk to us!</a>
        </li>
    
    

    
    <li class="divider"></li>
    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Bevezetés
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../installation/">
            
                <a href="../installation/">
            
                    
                    Installáció
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../how_the_internet_works/">
            
                <a href="../how_the_internet_works/">
            
                    
                    Hogy működik az Internet?
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../intro_to_command_line/">
            
                <a href="../intro_to_command_line/">
            
                    
                    Bevezetés a parancssor használatába
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../python_installation/">
            
                <a href="../python_installation/">
            
                    
                    A Python telepítése
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../code_editor/">
            
                <a href="../code_editor/">
            
                    
                    Kódszerkesztő (editor)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../python_introduction/">
            
                <a href="../python_introduction/">
            
                    
                    Bevezetés a Pythonba
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../django/">
            
                <a href="../django/">
            
                    
                    Mi a Django?
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../django_installation/">
            
                <a href="../django_installation/">
            
                    
                    Django telepítés
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="../django_start_project/">
            
                <a href="../django_start_project/">
            
                    
                    Az első Django projekted!
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="../django_models/">
            
                <a href="../django_models/">
            
                    
                    Django modellek
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="../django_admin/">
            
                <a href="../django_admin/">
            
                    
                    Django admin
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="../deploy/">
            
                <a href="../deploy/">
            
                    
                    Deploy!
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14" data-path="../django_urls/">
            
                <a href="../django_urls/">
            
                    
                    Django url-ek
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15" data-path="../django_views/">
            
                <a href="../django_views/">
            
                    
                    Django views - itt az ideje alkotni!
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16" data-path="../html/">
            
                <a href="../html/">
            
                    
                    Bevezetés a HTML-be
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17" data-path="../django_orm/">
            
                <a href="../django_orm/">
            
                    
                    Django ORM és QuerySet-ek
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18" data-path="../dynamic_data_in_templates/">
            
                <a href="../dynamic_data_in_templates/">
            
                    
                    Dinamikus adatok a template-ben
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19" data-path="../django_templates/">
            
                <a href="../django_templates/">
            
                    
                    Django sablonok (template)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.20" data-path="../css/">
            
                <a href="../css/">
            
                    
                    CSS - Tegyük széppé!
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.21" data-path="../template_extending/">
            
                <a href="../template_extending/">
            
                    
                    Template-kiegészítés
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.22" data-path="../extend_your_application/">
            
                <a href="../extend_your_application/">
            
                    
                    Egészítsd ki az applikációdat
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.23" data-path="./">
            
                <a href="./">
            
                    
                    Django űrlapok
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.24" data-path="../whats_next/">
            
                <a href="../whats_next/">
            
                    
                    Következő lépések
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://github.com/honkit/honkit" target="blank" class="gitbook-link">
            Published with HonKit
        </a>
    </li>
</ul>


                </nav>
            
        
  <div class="sidebar-addition">
      
        <a href="https://www.patreon.com/djangogirls" target="_blank">
      
        <img src="https://djangogirls.org/static/img/global/donate/lagos.jpg" />
      
        </a>
      
      
        <p>💖 Support our work and donate to our project! ✨</p>
      
      
      <a href="https://www.patreon.com/djangogirls" class="btn" target="_blank">
        Donate now!
      </a>
      
  </div>

    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Django űrlapok</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="django-űrlapok">Django űrlapok</h1>
<p>Utolsó lépésként azt fogjuk megcsinálni, hogy a blogposztokat ne csak az admin oldalon hozhassuk létre és szerkeszthessük. A Django <code>admin</code> menő, de elég nehéz személyre szabni, és nem is túl szép. A <code>form</code>ok (űrlapok) segítségével viszont majdnem mindent meg tudunk csinálni a felületünkön, amit csak szeretnénk!</p>
<p>A Django formokban az a jó, hogy ha akarjuk, teljesen az alapoktól is megírhatjuk őket, de <code>ModelForm</code>-ot is létrehozhatunk, ami az űrlap eredményét a modellbe menti el.</p>
<p>Pontosan ezt szeretnénk: egy űrlapot a <code>Post</code> modellünkhöz.</p>
<p>Mint minden fontos résznek a Django-ban, a formoknak is megvan a maguk helye: a <code>forms.py</code> fájl.</p>
<p>Hozz létre egy új fájlt ezzel a névvel a <code>blog</code> könyvtárban.</p>
<pre><code>blog
   └── forms.py
</code></pre><p>Rendben, most nyisd meg, és írd bele a következő kódot:</p>
<pre><code class="lang-python"><span class="hljs-keyword">from</span> django <span class="hljs-keyword">import</span> forms

<span class="hljs-keyword">from</span> .models <span class="hljs-keyword">import</span> Post

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PostForm</span>(<span class="hljs-params">forms.ModelForm</span>):</span>

    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Meta</span>:</span>
        model = Post
        fields = (<span class="hljs-string">&apos;title&apos;</span>, <span class="hljs-string">&apos;text&apos;</span>,)
</code></pre>
<p>Először importálnunk kell a Django formjait (<code>from django import forms</code>), és persze a <code>Post</code> modellünket is (<code>from .models import Post</code>).</p>
<p>Valószínűleg már sejted, hogy a <code>PostForm</code> az űrlapunk neve lesz. Meg kell mondanunk a Django-nak, hogy ez a form egy <code>ModelForm</code> (hogy egy kis Django varázslat kerüljön bele) - ezért a <code>forms.ModelForm</code> felelős.</p>
<p>Aztán a <code>class Meta</code> következik, itt mondjuk meg a Django-nak, hogy melyik modellt kell használnia az űrlap elkészítéséhez (<code>model = Post</code>).</p>
<p>Legvégül megadhatjuk, hogy melyik mezők kerüljenek bele az űrlapba. Mi csak a <code>title</code> (cím) és a <code>text</code> (szöveg) mezőket szeretnénk megjeleníteni - az <code>author</code> (szerző) az a felhasználó lesz, aki éppen be van jelentkezve (te magad!), és a <code>created_date</code>-et (létrehozás dátumát) automatikusan állítja be a Django, amikor elmented a posztot, emlékszel?</p>
<p>Ennyi az egész! Most már csak az van hátra, hogy használjuk az űrlapot egy <em>view</em>-ban, és megjelenítsük egy template-ben.</p>
<p>Tehát még egyszer: egy link az oldalhoz, egy URL, egy view és egy template.</p>
<h2 id="link-az-oldalhoz-ahol-az-űrlap-van">Link az oldalhoz, ahol az űrlap van</h2>
<p>Itt az ideje, hogy megnyisd a <code>blog/templates/blog/base.html</code> fájlt. Itt hozzáadunk egy linket a <code>page-header</code> nevű <code>div</code>hez:</p>
<pre><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;{% url &apos;post_new&apos; %}&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;top-menu&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;glyphicon glyphicon-plus&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
</code></pre>
<p>Figyelem: az új nézetünket <code>post_new</code>-nak fogjuk hívni. A <code>&quot;glyphicon glyphicon-plus&quot;</code> class a bootstrap theme biztosítja, és egy pluszjelet fog megjeleníteni.</p>
<p>Miután hozzáadtad ezt a sort, így fog kinézni a html fájlod:</p>
<pre><code class="lang-html">{% load static %}
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Django Girls blog<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&apos;//fonts.googleapis.com/css?family=Lobster&amp;subset=latin,latin-ext&apos;</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&apos;stylesheet&apos;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&apos;text/css&apos;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;{% static &apos;css/blog.css&apos; %}&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;page-header&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;{% url &apos;post_new&apos; %}&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;top-menu&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;glyphicon glyphicon-plus&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/&quot;</span>&gt;</span>Django Girls Blog<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;content container&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;row&quot;</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;col-md-8&quot;</span>&gt;</span>
                    {% block content %}
                    {% endblock %}
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>Ha elmented, és frissíted a <a href="http://127.0.0.1:8000" target="_blank">http://127.0.0.1:8000</a> oldalt, az ismerős <code>NoReverseMatch</code> hibát kell látnod, igaz?</p>
<h2 id="url">URL</h2>
<p>Nyisd meg a <code>blog/urls.py</code> fájlt, és add hozzá ezt a sort:</p>
<pre><code class="lang-python">    url(<span class="hljs-string">r&apos;^post/new/$&apos;</span>, views.post_new, name=<span class="hljs-string">&apos;post_new&apos;</span>),
</code></pre>
<p>Így fog kinézni a teljes kód:</p>
<pre><code class="lang-python"><span class="hljs-keyword">from</span> django.conf.urls <span class="hljs-keyword">import</span> url
<span class="hljs-keyword">from</span> . <span class="hljs-keyword">import</span> views

urlpatterns = [
    url(<span class="hljs-string">r&apos;^$&apos;</span>, views.post_list, name=<span class="hljs-string">&apos;post_list&apos;</span>),
    url(<span class="hljs-string">r&apos;^post/(?P&lt;pk&gt;[0-9]+)/$&apos;</span>, views.post_detail, name=<span class="hljs-string">&apos;post_detail&apos;</span>),
    url(<span class="hljs-string">r&apos;^post/new/$&apos;</span>, views.post_new, name=<span class="hljs-string">&apos;post_new&apos;</span>),
]
</code></pre>
<p>Ha frissíted az oldalt, egy <code>AttributeError</code>t fogsz látni, hiszen még nincs implementálva a <code>post_new</code> nevű view. Készítsük el most rögtön.</p>
<h2 id="postnew-nézet">post_new nézet</h2>
<p>Nyisd meg a <code>blog/views.py</code> fájlt, és add hozzá a következő sorokat:</p>
<pre><code class="lang-python"><span class="hljs-keyword">from</span> .forms <span class="hljs-keyword">import</span> PostForm
</code></pre>
<p>és a <em>view</em>t:</p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">post_new</span>(<span class="hljs-params">request</span>):</span>
    form = PostForm()
    <span class="hljs-keyword">return</span> render(request, <span class="hljs-string">&apos;blog/post_edit.html&apos;</span>, {<span class="hljs-string">&apos;form&apos;</span>: form})
</code></pre>
<p>Ahhoz, hogy egy új <code>Post</code> űrlapot kapjunk, meg kell hívnunk a <code>PostForm()</code>-ot, és továbbadni a template-nek. Még visszatérünk erre a <em>view</em>-ra, de előbb gyorsan készítsük egy sablont a formnak.</p>
<h2 id="template">Template</h2>
<p>Létre kell hoznunk egy <code>post_edit.html</code> nevű fájlt a <code>blog/templates/blog</code> könyvtárban. Ahhoz, hogy működjön az űrlapunk, szükségünk van pár dologra:</p>
<ul>
<li>meg kell jelenítenünk az űrlapot. Ezt egyszerűen megtehetjük a <code>{{ form.as_p }}</code> kóddal.</li>
<li>az előző sort be kell csomagolnunk egy HTML form tagbe: <code>&lt;form method=&quot;POST&quot;&gt;...&lt;/form&gt;</code></li>
<li>szükségünk van egy <code>Save</code> (Mentés) gombra. Ezt egy HTML gombbal tudjuk létrehozni: <code>&lt;button type=&quot;submit&quot;&gt;Save&lt;/button&gt;</code></li>
<li>és végül, a nyitó <code>&lt;form ...&gt;</code> tag után hozzá kell adnunk ezt: <code>{% csrf_token %}</code>. Ez nagyon fontos, mert ettől lesznek biztonságosak az űrlapjaid! A Django panaszkodni fog, ha úgy próbálod elmenteni a formot, hogy kifelejtetted ezt a részt:</li>
</ul>
<p><img src="images/csrf2.png" alt="CSFR tiltott oldal"></p>
<p>Rendben, nézzük, hogy néz ki a HTML kód a <code>post_edit.html</code>-ben:</p>
<pre><code class="lang-html">{% extends &apos;blog/base.html&apos; %}

{% block content %}
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>New post<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;POST&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;post-form&quot;</span>&gt;</span>{% csrf_token %}
        {{ form.as_p }}
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;save btn btn-default&quot;</span>&gt;</span>Save<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
{% endblock %}
</code></pre>
<p>Itt az ideje, hogy frissítsd az oldalt! Juhú! Ott van az űrlapod!</p>
<p><img src="images/new_form2.png" alt="Új űrlap"></p>
<p>De várjunk csak egy percet! Ha begépelsz valamit a <code>title</code> és a <code>text</code> mezőbe, és megpróbálod elmenteni - mi történik?</p>
<p>Semmi! Megint ugyanazon az oldalon vagyunk, és a szöveg eltűnt... és nem jött létre új bejegyzés. Mi romlott el?</p>
<p>A válasz: semmi. Csak még egy kicsit dolgoznunk kell a <em>view</em>-n.</p>
<h2 id="űrlap-mentése">Űrlap mentése</h2>
<p>Nyisd meg újra a <code>blog/views.py</code> fájlt. Most mindössze ennyi van a <code>post_new</code> nézetben:</p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">post_new</span>(<span class="hljs-params">request</span>):</span>
    form = PostForm()
    <span class="hljs-keyword">return</span> render(request, <span class="hljs-string">&apos;blog/post_edit.html&apos;</span>, {<span class="hljs-string">&apos;form&apos;</span>: form})
</code></pre>
<p>Amikor beküldünk egy űrlapot, ugyanabba a nézetbe kerülünk vissza, de ilyenkor a <code>request</code>ben több adat van, mint korábban, egész pontosan a <code>request.POST</code>-ban (ennek az elnevezésnek nincs köze a blogban lévő &quot;poszt&quot;-hoz, ez annyit jelent, hogy éppen adatokat &quot;posztolunk&quot;, vagyis küldünk). Emlékszel, hogy a HTML fájlban a <code>&lt;form&gt;</code> definíciójában szerepelt a <code>method=&quot;POST&quot;</code> változó? Most az űrlap minden mezője bekerült a <code>request.POST</code>-ba. Semmiképp se nevezd át a <code>POST</code> (a <code>method</code> másik érvényes értéke a <code>GET</code> lenne, de most nincs idő elmagyarázni a különbséget).</p>
<p>Tehát a <em>view</em>-ban két különböző esetet kell kezelnünk. Az első: amikor először kerülünk az oldalra, és egy üres űrlapot szeretnénk látni. A második: amikor visszajutunk a <em>view</em>-ba, azokkal az adatokkal, amiket épp az előbb gépeltünk be a formba. Ehhez egy feltételt kell hozzáadnunk (az <code>if</code>-et fogjuk használni).</p>
<pre><code class="lang-python"><span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&quot;POST&quot;</span>:
    [...]
<span class="hljs-keyword">else</span>:
    form = PostForm()
</code></pre>
<p>Itt az ideje, hogy kitöltsük a <code>[...]</code> részeket. Ha a <code>method</code> <code>POST</code>, akkor egy <code>PostForm</code>-ot szeretnénk létrehozni az űrlapban beküldött adatokból, igaz? Ezt így tehetjük meg:</p>
<pre><code class="lang-python">form = PostForm(request.POST)
</code></pre>
<p>Nem nehéz! A következő, hogy ellenőrizzük, helyes-e az űrlap (minden kötelező mező ki lett-e töltve, és nem készülünk-e helytelen adatokat elmenteni). Ezt csinálja a <code>form.is_valid()</code>.</p>
<p>Megnézzük, hogy érvényes-e a form, és ha igen, elmenthetjük!</p>
<pre><code class="lang-python"><span class="hljs-keyword">if</span> form.is_valid():
    post = form.save(commit=<span class="hljs-literal">False</span>)
    post.author = request.user
    post.published_date = timezone.now()
    post.save()
</code></pre>
<p>Itt lényegében két dolog történik: elmentjük az űrlapot a <code>form.save</code> paranccsal, és hozzáadunk egy szerzőt (mivel nem volt <code>author</code> mező a <code>PostForm</code>-ban, viszont ez a mező kötelező!). A <code>commit=False</code> azt jelenti, hogy még nem mentjük el a <code>Post</code> modellt - előbb még hozzá akarunk adni egy szerzőt. Az idő nagy részében a <code>commit=False</code> nélkül fogod használni a <code>form.save()</code>-et, de most szükségünk van erre a részre. A <code>post.save()</code> megőrzi a változtatásokat (szerző hozzáadása), és létrehoz egy új blogposztot!</p>
<p>Végül tök jó lenne, ha egyből a frissen elkészült bejegyzés <code>post_detail</code> oldalára jutnánk nem? Ehhez egy újabb importra van szükségünk:</p>
<pre><code class="lang-python"><span class="hljs-keyword">from</span> django.shortcuts <span class="hljs-keyword">import</span> redirect
</code></pre>
<p>Ezt írd a fájlod elejére. És most megmondhatjuk a Django-nak: menj az új blogposzt <code>post_detail</code> oldalára.</p>
<pre><code class="lang-python"><span class="hljs-keyword">return</span> redirect(<span class="hljs-string">&apos;post_detail&apos;</span>, pk=post.pk)
</code></pre>
<p>A <code>post_detail</code> a nézet neve, ahova most menni akarunk. Emlékszel, hogy ez a <em>view</em> egy <code>pk</code> változót kér? Ahhoz, hogy ezt megkapja, a <code>pk=post.pk</code> részt használjuk, ahol a <code>post</code> az új blogposztunkat jelenti!</p>
<p>Rendben, elég sokat beszéltünk, de most már látni szeretnéd, hogy néz ki a teljes <em>view</em>, igaz?</p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">post_new</span>(<span class="hljs-params">request</span>):</span>
    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&quot;POST&quot;</span>:
        form = PostForm(request.POST)
        <span class="hljs-keyword">if</span> form.is_valid():
            post = form.save(commit=<span class="hljs-literal">False</span>)
            post.author = request.user
            post.published_date = timezone.now()
            post.save()
            <span class="hljs-keyword">return</span> redirect(<span class="hljs-string">&apos;post_detail&apos;</span>, pk=post.pk)
    <span class="hljs-keyword">else</span>:
        form = PostForm()
    <span class="hljs-keyword">return</span> render(request, <span class="hljs-string">&apos;blog/post_edit.html&apos;</span>, {<span class="hljs-string">&apos;form&apos;</span>: form})
</code></pre>
<p>Nézzük meg, hogy működik-e. Menj a <a href="http://127.0.0.1:8000/post/new/" target="_blank">http://127.0.0.1:8000/post/new/</a> oldalra, adj hozzá egy <code>title</code>-t és egy <code>text</code>-et, mentsd el... és voilà! Az új poszt bekerült az adatbázisba, és át lettél irányítva a <code>post_detail</code> oldalra!</p>
<p>Talán észrevetted, hogy a poszt elmentése előtt beállítjuk a közzététel dátumát. Később, a <strong>Django Girls Tutorial: Extensions</strong> részben egy <em>publish</em> gombot is készítünk.</p>
<p>Ez nagyszerű!</p>
<blockquote>
<p>Mivel nemrég használtuk a Django admin felületét, a rendszer most azt hiszi, hogy be vagyunk jelentkezve. Néhány esetben előfordul, hogy a rendszer kijelentkeztet minket (pl. ha bezárod a böngészőt vagy újraindítod az adatbázist). Ha azt veszed észre, hogy a hibaüzenetek arra utalnak, hogy nincs bejelentkezett felhasználó, menj az admin oldalra -<a href="http://127.0.0.1:8000/admin" target="_blank">http://127.0.0.1:8000/admin</a> - és jelentkezz be újra. Ez ideiglenesen megoldja a problémát. Van egy hosszútávú megoldás is a <strong>Házi feladat: tedd biztonságosabbá a weboldalad!</strong> fejezetben a tutorial fő része után.</p>
</blockquote>
<p><img src="images/post_create_error.png" alt="Bejelentkezési hiba"></p>
<h2 id="form-validáció">Form validáció</h2>
<p>Most megmutatjuk, mennyire menők a Django űrlapok. Egy blogposztnak kell, hogy legyen <code>title</code> és <code>text</code> mezője. A <code>Post</code> modellben nem jelentettük ki külön, hogy ezek a mezők nem kötelezőek (ellentétben a <code>published_date</code> mezővel), ezért a Django elvárja, hogy ki legyenek töltve.</p>
<p>Próbáld meg elmenteni az űrlapot <code>title</code> vagy <code>text</code> nélkül. Találd ki, mi fog történni!</p>
<p><img src="images/form_validation2.png" alt="Form validáció"></p>
<p>A Django gondoskodik az összes mező ellenőrzéséről. Hát nem fantasztikus?</p>
<h2 id="űrlapok-szerkesztése">Űrlapok szerkesztése</h2>
<p>Most már tudod, hogyan tudsz új formot hozzáadni. De mi van, ha egy létező űrlapot szeretnél módosítani? Az eddigiekhez nagyon hasonlóan fog működni. Gyorsan készítsük néhány fontos dolgot (ha nem értesz valamit, kérdezd meg a coachodat, vagy nézz bele az előző fejezetekbe, hiszen ezeket a lépéseket már mind megcsináltad egyszer).</p>
<p>Nyisd meg a <code>blog/templates/blog/post_detail.html</code> fájlt, és add hozzá ezt a sort:</p>
<pre><code class="lang-python">&lt;a class=&quot;btn btn-default&quot; href=&quot;{% url &apos;post_edit&apos; pk=post.pk %}&quot;&gt;&lt;span class=&quot;glyphicon glyphicon-pencil&quot;&gt;&lt;/span&gt;&lt;/a&gt;
</code></pre>
<p>Így fog kinézni a template:</p>
<pre><code class="lang-html">{% extends &apos;blog/base.html&apos; %}

{% block content %}
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;post&quot;</span>&gt;</span>
        {% if post.published_date %}
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;date&quot;</span>&gt;</span>
                {{ post.published_date }}
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        {% endif %}
        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-default&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;{% url &apos;post_edit&apos; pk=post.pk %}&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;glyphicon glyphicon-pencil&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>{{ post.title }}<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{{ post.text|linebreaksbr }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
{% endblock %}
</code></pre>
<p>A <code>blog/urls.py</code>-ban pedig erre a sorra lesz szükségünk:</p>
<pre><code class="lang-python">    url(<span class="hljs-string">r&apos;^post/(?P&lt;pk&gt;[0-9]+)/edit/$&apos;</span>, views.post_edit, name=<span class="hljs-string">&apos;post_edit&apos;</span>),
</code></pre>
<p>Itt újrahasznosíthatjuk a <code>blog/templates/blog/post_edit.html</code> sablont, szóval már csak egy <em>view</em> van hátra.</p>
<p>Nyisd meg a <code>blog/views.py</code>-t, és add hozzá ezt a fájl végén:</p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">post_edit</span>(<span class="hljs-params">request, pk</span>):</span>
    post = get_object_or_404(Post, pk=pk)
    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&quot;POST&quot;</span>:
        form = PostForm(request.POST, instance=post)
        <span class="hljs-keyword">if</span> form.is_valid():
            post = form.save(commit=<span class="hljs-literal">False</span>)
            post.author = request.user
            post.published_date = timezone.now()
            post.save()
            <span class="hljs-keyword">return</span> redirect(<span class="hljs-string">&apos;post_detail&apos;</span>, pk=post.pk)
    <span class="hljs-keyword">else</span>:
        form = PostForm(instance=post)
    <span class="hljs-keyword">return</span> render(request, <span class="hljs-string">&apos;blog/post_edit.html&apos;</span>, {<span class="hljs-string">&apos;form&apos;</span>: form})
</code></pre>
<p>Majdnem pont úgy néz ki, mint a <code>post_new</code> view, nem igaz? De nem teljesen. Először is átadunk egy extra <code>pk</code> paramétert az url-ekből. Aztán a <code>Post</code> modellt a <code>get_object_or_404(Post, pk=pk)</code> sorral kapjuk meg, és végül, amikor létrehozzuk a formot, ezt a posztot adjunk át <code>instance</code>-ként, amikor elmentjük:</p>
<pre><code class="lang-python">form = PostForm(request.POST, instance=post)
</code></pre>
<p>és akkor is, amikor megnyitjuk az űrlapot, hogy szerkeszthessük a posztot:</p>
<pre><code class="lang-python">form = PostForm(instance=post)
</code></pre>
<p>Oké, most teszteljük le, hogy működik-e! Menj a <code>post_detail</code> oldalra. Kell lennie egy szerkesztés gombnak a jobb felső sarokban:</p>
<p><img src="images/edit_button2.png" alt="Szerkesztés gomb"></p>
<p>Ha rákattintasz, megkapod az űrlapot a blogposzttal:</p>
<p><img src="images/edit_form2.png" alt="Űrlapok szerkesztése"></p>
<p>Változtasd meg a címet vagy a szöveget, és mentsd el!</p>
<p>Gratulálunk! Az alkalmazásod egyre és egyre jobb!</p>
<p>Ha szeretnél többet tudni a Django formokról, olvass róluk a dokumentációban: <a href="https://docs.djangoproject.com/en/1.11/topics/forms/" target="_blank">https://docs.djangoproject.com/en/1.11/topics/forms/</a></p>
<h2 id="biztonság">Biztonság</h2>
<p>Nagyon jó, hogy az új blogposztok írásához csak egy linkre kell kattintani! Viszont most bárki létre tud hozni egy új bejegyzést, aki meglátogatja az oldaladat, és valószínűleg ezt nem szeretnéd. Csináljuk meg, hogy a gombot csak te lásd, és mások ne.</p>
<p>A <code>blog/templates/blog/base.html</code>-ben keresd meg a <code>page-header</code> <code>div</code>et, és az anchor taget, amit korábban írtál bele. Így néz ki:</p>
<pre><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;{% url &apos;post_new&apos; %}&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;top-menu&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;glyphicon glyphicon-plus&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
</code></pre>
<p>Írunk még egy <code>{% if %}</code> taget, ami arra lesz jó, hogy csak azoknak az usereknek mutassa a linket, akik be vannak jelentkezve az adminba. Most ez csak te vagy! Változtasd meg a <code>&lt;a&gt;</code> taget, hogy így nézzen ki:</p>
<pre><code class="lang-html">{% if user.is_authenticated %}
    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;{% url &apos;post_new&apos; %}&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;top-menu&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;glyphicon glyphicon-plus&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
{% endif %}
</code></pre>
<p>Az <code>{% if %}</code> miatt a link csak akkor küldődik át a böngészőbe, ha a felhasználó, aki lekérte az oldalt, be van jelentkezve. Ez nem akadályozza meg teljesen az új posztok létrehozását, de kezdésnek jó. A kiegészítő leckékben többet is tanulhatsz a biztonságról.</p>
<p>Mivel valószínűleg be vagy jelentkezve, semmi változást nem fogsz látni, ha frissítesz. Viszont ha megnyitod az oldalt egy másik böngészőben, vagy egy inkognitóablakban, látni fogod, hogy a link nincs ott!</p>
<h2 id="még-egy-dolog-itt-az-ideje-egy-újabb-deploynak">Még egy dolog: itt az ideje egy újabb deploynak!</h2>
<p>Nézzük meg, hogy működik-e ez az egész a PythonAnywhere-en. Itt az ideje egy újabb deploynak!</p>
<ul>
<li><p>Először is commitold az új kódodat, és pushold GitHubra</p>
<pre><code>$ git status
$ git add --all .
$ git status
$ git commit -m &quot;Added views to create/edit blog post inside the site.&quot;
$ git push
</code></pre></li>
<li><p>Aztán írd be ezt a <a href="https://www.pythonanywhere.com/consoles/" target="_blank">PythonAnywhere Bash konzol</a>ba:</p>
</li>
</ul>
<pre><code>$ cd my-first-blog
$ source myvenv/bin/activate
(myvenv)$ git pull
[...]
(myvenv)$ python manage.py collectstatic
[...]
</code></pre><ul>
<li>Végül menj a <a href="https://www.pythonanywhere.com/web_app_setup/" target="_blank">Web tab</a>-ra, és nyomj <strong>Reload</strong>ot.</li>
</ul>
<p>Ennyi az egész. Gratulálunk :)</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="../extend_your_application/" class="navigation navigation-prev " aria-label="Previous page: Egészítsd ki az applikációdat">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../whats_next/" class="navigation navigation-next " aria-label="Next page: Következő lépések">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Django űrlapok","level":"1.23","depth":1,"next":{"title":"Következő lépések","level":"1.24","depth":1,"path":"whats_next/README.md","ref":"whats_next/README.md","articles":[]},"previous":{"title":"Egészítsd ki az applikációdat","level":"1.22","depth":1,"path":"extend_your_application/README.md","ref":"extend_your_application/README.md","articles":[]},"dir":"ltr"},"config":{"plugins":["heading-anchors@1.0.3","ga@1.0.1","richquotes@0.0.9","github@2.0.0","language-picker","sidebar-ad","codeblock-label","sectionx-ex","collapsible-menu"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"collapsible-menu":{},"language-picker":{"grid-columns":3},"github":{"url":"https://github.com/DjangoGirls/tutorial"},"codeblock-label":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sectionx-ex":{},"fontsettings":{"theme":"white","family":"sans","size":2},"richquotes":{"default":false},"sectionx":{"tag":"b"},"heading-anchors":{},"sidebar-ad":{"imageUrl":"https://djangogirls.org/static/img/global/donate/lagos.jpg","url":"https://www.patreon.com/djangogirls","description":"💖 Support our work and donate to our project! ✨","btnText":"Donate now!"},"highlight":{},"ga":{"configuration":"auto","token":"UA-51680040-3"},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56},"embedFonts":false},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{"py_version":"3.8","py_release":"3.8.6","py_min_version":"3.6","py_min_release":"3.6.8","pa_py_version":"3.8","django_version":"3.2.10"},"language":"hu","links":{"sidebar":{"Need help? Talk to us!":"https://gitter.im/DjangoGirls/tutorial"}},"gitbook":"*"},"file":{"path":"django_forms/README.md","mtime":"2022-11-25T15:13:00.083Z","type":"markdown"},"gitbook":{"version":"3.7.5","time":"2022-11-25T15:13:18.368Z"},"basePath":"..","book":{"language":"hu"}});
        });
    </script>
</div>

        
    <noscript>
        <style>
            .honkit-cloak {
                display: block !important;
            }
        </style>
    </noscript>
    <script>
        // Restore sidebar state as critical path for prevent layout shift
        function __init__getSidebarState(defaultValue){
            var baseKey = "";
            var key = baseKey + ":sidebar";
            try {
                var value = localStorage[key];
                if (value === undefined) {
                    return defaultValue;
                }
                var parsed = JSON.parse(value);
                return parsed == null ? defaultValue : parsed;
            } catch (e) {
                return defaultValue;
            }
        }
        function __init__restoreLastSidebarState() {
            var isMobile = window.matchMedia("(max-width: 600px)").matches;
            if (isMobile) {
                // Init last state if not mobile
                return;
            }
            var sidebarState = __init__getSidebarState(true);
            var book = document.querySelector(".book");
            // Show sidebar if it enabled
            if (sidebarState && book) {
                book.classList.add("without-animation", "with-summary");
            }
        }

        try {
            __init__restoreLastSidebarState();
        } finally {
            var book = document.querySelector(".book");
            book.classList.remove("honkit-cloak");
        }
    </script>
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/1.2.1/anchor.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-heading-anchors/anchor-style.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-ga/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-language-picker/plugin.js"></script>
        
    
        
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sectionx-ex/sectionx.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-collapsible-menu/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

